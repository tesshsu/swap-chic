var state,mes,file,instanse=!1;function Chat(){this.update=updateChat,this.send=sendChat,this.getState=getStateOfChat}function getStateOfChat(t,a){instanse||(instanse=!0,jQuery.post(swapchic_chat.ajax_url,{action:"chatGetState",ids:t,post_id:a},function(a){if(data=JSON.parse(a),state=data.state,instanse=!1,data.text){for(var e=0;e<data.text.length;e++)jQuery("#chat-area").append(jQuery(data.text[e])),jQuery("#chat-area > div").each(function(){jQuery(this).attr("data-from")==t[0]&&jQuery(this).addClass("mine")});jQuery(window).scrollTop(jQuery(document).height())}}))}function updateChat(t,a){instanse||(instanse=!0,jQuery.post(swapchic_chat.ajax_url,{action:"chatUpdate",state:state,ids:t,post_id:a},function(a){if(data=JSON.parse(a),data.text){for(var e=0;e<data.text.length;e++)jQuery("#chat-area").append(jQuery(data.text[e]));jQuery(window).scrollTop(jQuery(document).height())}instanse=!1,state=data.state,jQuery("#chat-area > *:last-child").attr("data-from")==t[0]&&jQuery("#chat-area > *:last-child").addClass("mine")}))}function sendChat(t,a,e,n){updateChat(a,e),jQuery.post(swapchic_chat.ajax_url,{action:"chatSend",message:t,ids:a,post_id:e},function(t){data=JSON.parse(t),notify(a[1],"chat",n,-1),updateChat(a,e)})}function openChat(t,a){jQuery.post(swapchic_chat.ajax_url,{action:"chatOpen",user_id:t,partner_id:a},function(t){window.location.assign(t)})}var autoExpand=function(t){t.style.height="calc(1.25em + 20px)";var a=window.getComputedStyle(t),e=parseInt(a.getPropertyValue("border-top-width"),10)+t.scrollHeight+parseInt(a.getPropertyValue("border-bottom-width"),10);t.style.height=e+"px"};document.addEventListener("input",function(t){"textarea"===t.target.tagName.toLowerCase()&&autoExpand(t.target)},!1);